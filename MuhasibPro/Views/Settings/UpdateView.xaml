<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MuhasibPro.Views.Settings.UpdateView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dev="using:DevWinUI"
    mc:Ignorable="d"
    Unloaded="Page_Unloaded">

    <Page.Resources>
        <x:Double x:Key="SettingsCardSpacing">4</x:Double>
        <Style
            x:Key="SettingsSectionHeaderTextBlockStyle"
            BasedOn="{StaticResource BodyStrongTextBlockStyle}"
            TargetType="TextBlock">
            <Style.Setters>
                <Setter Property="Margin" Value="1,32,0,6" />
            </Style.Setters>
        </Style>

        <!-- Main Update Card Style -->
        <Style x:Key="MainUpdateCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource CardBackgroundFillColorDefaultBrush}" />
            <Setter Property="BorderBrush" Value="{ThemeResource CardStrokeColorDefaultBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="Padding" Value="20" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            MaxWidth="1064"
            Margin="36,24,36,0"
            AutomationProperties.HeadingLevel="Level1"
            Style="{StaticResource TitleTextBlockStyle}"
            Text="MuhasibPro Güncelleme" />

        <StackPanel
            Grid.Row="1"
            MaxWidth="1064"
            Margin="36,24,36,0"
            Spacing="12">
            <StackPanel.ChildrenTransitions>
                <AddDeleteThemeTransition />
                <RepositionThemeTransition />
            </StackPanel.ChildrenTransitions>

            <Grid VerticalAlignment="Center" ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Viewbox Grid.Column="0" MaxWidth="44" MaxHeight="44">
                    <FontIcon
                        FontFamily="{ThemeResource SymbolThemeFontFamily}"
                        Foreground="{x:Bind StatusIconBrush, Mode=OneTime}"
                        Glyph="{x:Bind ViewModel.StatusIconGlyph, Mode=OneWay}" />
                </Viewbox>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock
                        FontSize="18"
                        Style="{ThemeResource BodyStrongTextBlockStyle}"
                        Text="{x:Bind ViewModel.StatusText, Mode=OneWay}" />
                    <TextBlock
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Style="{ThemeResource CaptionTextBlockStyle}"
                        Text="{x:Bind ViewModel.LastCheckText, Mode=OneWay}" />
                </StackPanel>

                <Button
                    Height="40"
                    Grid.Column="2"
                    MinWidth="180"
                    VerticalAlignment="Center"
                    Command="{x:Bind ViewModel.CheckNowCommand}"
                    Content="Güncelleştirmeleri denetle"
                    IsEnabled="{x:Bind ViewModel.IsCheckButtonEnabled, Mode=OneWay}" />
            </Grid>

            <Border
                Padding="20"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="6"
                Visibility="{x:Bind UpdateCardVisibility, Mode=OneWay}">

                <StackPanel Spacing="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock
                                FontSize="18"
                                FontWeight="SemiBold"
                                Foreground="{StaticResource ApplicationForegroundThemeBrush}"
                                Text="{x:Bind ViewModel.VersionText, Mode=OneWay}" />

                            <StackPanel
                                Orientation="Horizontal"
                                Spacing="20"
                                Visibility="{x:Bind UpdateDetailsVisibility, Mode=OneWay}">
                                <TextBlock
                                    FontSize="13"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Visibility="{x:Bind ViewModel.UpdateSize, Converter={StaticResource StringToVisibilityConverter}, Mode=OneWay, FallbackValue=Collapsed}">
                                    <Run Text="Boyut:" />
                                    <Run FontWeight="Medium" Text="{x:Bind ViewModel.UpdateSize, Mode=OneWay}" />
                                </TextBlock>
                                <TextBlock
                                    FontSize="13"
                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                    Visibility="{x:Bind ViewModel.ReleaseDate, Converter={StaticResource StringToVisibilityConverter}, Mode=OneWay}">
                                    <Run Text="Yayınlanma:" />
                                    <Run FontWeight="Medium" Text="{x:Bind ViewModel.ReleaseDate, Mode=OneWay}" />
                                </TextBlock>
                                <HyperlinkButton
                                    Command="{x:Bind OpenChangelogCommand}"
                                    Content="Yenilikleri gör"
                                    FontSize="13"
                                    Padding="0,0,0,2"
                                    Visibility="{x:Bind ChangelogButtonVisibility, Mode=OneWay}" />
                            </StackPanel>
                        </StackPanel>

                        <Button
                            Grid.Column="1"
                            MinWidth="180"
                            Height="36"
                            VerticalAlignment="Top"
                            Command="{x:Bind ViewModel.UpdateActionCommand}"
                            Content="{x:Bind ViewModel.UpdateButtonText, Mode=OneWay}"
                            IsEnabled="{x:Bind ViewModel.IsUpdateButtonEnabled, Mode=OneWay}"
                            Style="{ThemeResource AccentButtonStyle}" />
                    </Grid>

                    <StackPanel Spacing="10" Visibility="{x:Bind ProgressVisibility, Mode=OneWay}">
                        <ProgressBar
                            Height="4"
                            CornerRadius="2"
                            Maximum="100"
                            Value="{x:Bind ViewModel.ProgressPercentage, Mode=OneWay}" />
                        <Grid>
                            <TextBlock
                                HorizontalAlignment="Left"
                                FontSize="13"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="{x:Bind ViewModel.ProgressText, Mode=OneWay}" />
                            <TextBlock
                                HorizontalAlignment="Right"
                                FontSize="13"
                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                Text="{x:Bind ViewModel.ProgressDetails, Mode=OneWay}"
                                Visibility="{x:Bind ViewModel.ProgressDetails, Converter={StaticResource StringToVisibilityConverter}, Mode=OneWay}" />
                        </Grid>
                    </StackPanel>

                    <Border
                        Padding="16,12"
                        Background="{ThemeResource SystemFillColorCriticalBackgroundBrush}"
                        BorderBrush="{ThemeResource SystemFillColorCriticalBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Visibility="{x:Bind ErrorVisibility, Mode=OneWay}">
                        <Grid ColumnSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <FontIcon
                                Grid.Column="0"
                                FontSize="16"
                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                Glyph="&#xE783;" />
                            <TextBlock
                                Grid.Column="1"
                                FontSize="14"
                                Text="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                                TextWrapping="Wrap" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Settings Section -->
        <ScrollView
            Grid.Row="2"
            Padding="36,0,36,36"
            VerticalScrollBarVisibility="Auto"
            VerticalScrollMode="Auto">

            <StackPanel MaxWidth="1064" Spacing="{StaticResource SettingsCardSpacing}">
                <StackPanel.ChildrenTransitions>
                    <RepositionThemeTransition />
                </StackPanel.ChildrenTransitions>

                <!-- Advanced Options Header -->
                <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Gelişmiş seçenekler" />

                <!-- Auto Check Setting -->
                <dev:SettingsCard 
                    Description="Uygulama başlatıldığında güncellemeleri otomatik olarak kontrol et" 
                    Header="En son güncellemeleri mümkün olan en kısa sürede alın">
                    <dev:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE895;" />
                    </dev:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.AutoCheckEnabled, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                        
                    </ToggleSwitch>
                </dev:SettingsCard>               

                <!-- Notifications Setting -->
                <dev:SettingsCard
                    Description="Güncellemeler yüklenmeye hazır olduğunda bir bildirim göster"
                    Header="Güncelleme bildirimleri">
                    <dev:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE91C;" />
                    </dev:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.NotificationsEnabled, Mode=TwoWay}">
                        
                    </ToggleSwitch>
                </dev:SettingsCard>

                <!-- Beta Versions Setting -->
                <dev:SettingsCard 
                    Description="Beta sürümlerini ve önizleme sürümlerini al" 
                    Header="Beta sürümlerini dahil et">
                    <dev:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE7BA;" />
                    </dev:SettingsCard.HeaderIcon>
                    <ToggleSwitch IsOn="{x:Bind ViewModel.IncludeBetaVersionsEnabled, Mode=TwoWay}">
                        
                    </ToggleSwitch>
                </dev:SettingsCard>              

            </StackPanel>
        </ScrollView>
    </Grid>
</Page>
